# 移动测试大作业

一个基于appium的Android自动测试工具，算法主要为DFS加上大量hack。

NJUSE 2019年春季学期软件测试课程大作业。

# 使用

使用Intellij IDEA打开，并安装lombok插件。

`mvn package`打包成一个jar包。

# 坑记录

以下为应用在Android 6.0虚拟机上的情况

| 应用 | 坑 |
| -- | -- |
| Jianshi | 无法登录和注册，提示网络错误 |
| Odyssey | aapt分析出的启动activity转瞬而过，appium一直等待已经结束的activity启动直到超时；并且启动activity结束后是个权限弹窗，点击后进入另一个activity，appium仍然无法恢复 |
| Leafpic | 应用启动前权限弹窗，appium卡住；手动确认权限后可以正常进行脚本 | 
| Bihudaily | 点击Night Mode强退 | 
| SeeWeather | 多城市里添加城市会强退; 选择城市点击后界面没有变化 | 
| Jiandou | 没有数据；点击“电影榜单”会强退 |

# 进度 

| 应用 | 6.0进度 | 4.4进度 | 5.0进度 | 7.0进度 | 
| -- | -- | -- | -- | -- |
| bihudaily | 挺好 |  |  | |
| Bilibili | 太长不想测了 |  | | |
| GeekNews | 应该还行吧，每次都是测着测着模拟器黑屏了，但是在正常跑  |  | | |
| GuDong | 挺好 |  | | |
| ITHouse | 没有进行搜索，不知道为什么 |  | | |
| Jiandou | 没点搜索，几个界面的tab没点，是因为tagName有非法字符$  | | | |
| Jianshi | 登录不了 | | | |
| Leafpic  | 进不去 | | | |
| Odyssey | 1.13.0进去感觉效果还行 | | | |
| SeeWeather | 在选城市界面疯狂崩溃，或者一进去就崩溃 | | | |

# 相关问题

1. 程序一直在Windows 10，Appium 1.4.16，虚拟机版本6.0上进行测试。在Appium 1.4.16版本上无法启动Odyssey和Leafpic（见上表），在appium 1.13.0版本上无法运行Leafpic，但是可以正常进行Odyssey。
2. 程序的解析参数部分已经在Windows Subsystem for Linux （发行版Arch）上进行测试，但是由于路径的原因无法测试脚本是否能够实际运行脚本。请助教尝试是否能在真实Linux的环境下正常使用，若不能使用，请检查下列可能的原因：
- `assets/aapt`文件没有授予可执行权限
- 项目存放路径或者apk路径名含有空格（不清楚此问题到底会不会带来影响）
3. 本脚本假设**覆盖率计算不会因为程序退出/崩溃而归零**。本脚本处理了崩溃、分享界面以及进入其他App的场景（例如打开了浏览器），对于不能按一下返回键返回应用的界面，脚本将会判断为程序已经退出，将会使用`driver.resetApp()`方法重启应用。对于有的场景，例如抽屉布局的子布局界面，当当前界面已经遍历完成后，程序将会采用退出重启的方式回到主界面并继续遍历，这是预期行为，并非bug。我已经询问过助教程序重启是否会影响覆盖计算但是没有得到回应，且有的应用（例如bihudaily）在点击一些控件的时候必定崩溃，故做出如此假设。
4. 本脚本假设运行时间为**20分钟**，并针对这个时间限制进行了一些针对性的优化
5. 本脚本设置在在限制时间到达后自动`System.exit(0);`，但是理论上来说在限制时间到达之前程序不会自动退出。当程序认为它已经遍历完所有可能的界面后，其应该会在主界面循环执行退出程序和重启操作。我认为，这并不会违反规则，故并没有对这个行为做出修改。
